---
title: "R Studioで計量経済分析(1)"
author: "成田 慶之"
date: today
format: html
---

## はじめに

本資料は統計ソフト**R**を用いて回帰分析を行なう際のコードの書き方を教えるものである。この資料は**R**およびそのIDE(統合開発環境)である**R Studio**をダウンロードした前提で進める。

今からダウンロードする場合、以下のサイトの「2 Rのインストール」「3 IDEの導入」を参照すると良い。

[私たちのR](https://www.jaysong.net/RBook/){.external}

本題に入る前に、超超超基本的なRの操作について説明しておく。

#### コードはどこに書くのか?

```{=html}
<video controls width="800">
  <source src="R_Studio_lec(1).mp4" type="video/mp4">
</video>
```


#### 代入：何らかの変数に値を代入する

```{r}
#| cache: true
x <- 5 # xに5を代入した
x      # 5が出力される
# 色々なものを代入できる
Narita <- c("Aomori")
Narita
```

#### 四則演算

```{r}
5 + 3    # 足し算
100 - 33 # 引き算
33 * 9   # かけ算
22 / 11  # 割り算
```

## パッケージのインストールと読み込み

Rで統計分析やデータの編集を行なう際、**パッケージ**というものが必要不可欠。

パッケージとは、R上で実行出来る関数(function)やデータ(data)が含まれたセットを指す。

私たちが何か料理(目的となる分析)を行なう際、様々な調理器具(関数)や具材(データ)を用いることになるが、パッケージはいわば調理器具セット or 具材セットのようなものであり、そのセットの中から目的に合った調理器具と具材を利用する。

### パッケージのインストール

パッケージのインストールは、いわばお店でそれらのセットを**購入**することを意味する。 試しに{tidyverse}という名前のパッケージをインストールする。 `install.packages("パッケージ名")`という関数を使う(この関数自体は初めからRに内蔵されている)

```{r}
#| eval: false
install.packages("tidyverse")
```

一度インストールしたパッケージは、PCのファイル内に保存されるため、次回起動時にインストールする必要はない[^1]。

[^1]: パッケージは度々新しい機能が追加されたりするため、その時は再度`install.packages()`を行なってアップデートする。

### パッケージの読み込み

パッケージのインストールと読み込みは異なる操作である。

あなたは調理器具セット・具材セットを購入(インストール)したが、調理器具は棚へ、具材は冷蔵庫にしまうはずだ。そして、いざ調理(分析)に用いる際にそこから**取り出し**て使用しなければならない。パッケージの読み込みは、この**取り出し**に相当する。

先ほどの{tidyvese}というパッケージを今度は読み込んでみる。使う関数は`library(パッケージ名)`または`require(パッケージ名)`。

```{r}
library(tidyverse)
```

何やら大量に**Warning**の文字が出力されているが無視してOK。 RにおいてWarningが表示されたとき、コード自体は正しく実行されており、一応の懸念点をRのソフトが教えてくれているだけである[^2]。

[^2]: 別の関数を使用する際に出力されるWarningは少し気にしとくと良い。

ただし**Error**が表示された場合、コードが正しく実行されていないため、何らかの修正が必要である。

一度読み込んだパッケージはRのソフトが終了すると、自動的に棚or冷蔵庫に戻ってしまう。そのため、分析者はRを起動するたびに`library()`,`require()`でパッケージを呼び出さなければならない。

## OLS回帰分析

最小2乗法(OLS)は計量経済学の基本であり、卒業論文や課題レポートなどにおいて、学生が最も利用する分析方法である(多分)。

R上においてOLSを行なうことは極めて容易で、用いる関数は`lm(被説明変数 ~ 説明変数, data = 利用するデータセット)`である。

### 実際にOLS回帰分析を行なってみる

ここでは{wooldrige}というパッケージに含まれるcrime4というデータセットを用いて、OLS回帰分析を実行してみる。

#### {wooldridge}のインストールと読み込み

```{r}
#| eval: false
install.packages("wooldridge")
```

```{r}
library(wooldridge)
```

#### {crime4}のデータでOLS回帰分析を行なう

以下のモデルを推定する

$crmrte_{it} = \beta_{0} + \beta_{1}taxpc_{it} + \beta_{2}polpc_{it} + u_{it}$

i,tはt年のi地域を示しており、$u$は誤差項を表している。また、各変数は$crmrte$ (1人当たり犯罪数), $taxpc$ (1人当たり税収入), $polpc$ (1人当たり警察官数)である。

```{r}
#| cache: true
# 上記の式を基にlm()関数を実行する
lm(crmrte ~ taxpc + polpc, data = crime4)

```

推定された係数値が表示された(\^\^)。

#### 推定結果の詳細を表示する

`lm()`関数を用いることで推定値が出力されたが、それだけでは不十分である。

統計分析において**推定された値が統計的に有意かどうか**が極めて重要である。 上記の出力結果では統計的な優位性に関して何も教えてくれない...

そこで、以下のように出力の仕方を変えることで、統計的な優位性も一目で分かる出力結果表を得ることが出来る。

```{r}
#| cache: true
# lm()の分析結果を何らかの変数に代入する
result <- lm(crmrte ~ taxpc + polpc, data = crime4)

# summary()と言う関数の括弧内に上記の変数(result)を代入する
summary(result)
```

-----------------------------------------------------------------------

今度は色々と出力されて煩わしく感じるが、Coefficients:と書かれた下側の表がメインの推定結果を示している。

Estimateの行を見ると、先ほど`lm()`で出力した係数値を四捨五入した値と、同じ値が出ていることが分かる[^3]。

[^3]: 1.934e-02は$1.934 \times 10^{-2} = 0.01934$を示す。

では統計的な優位性について確認しよう。同じ表のPr(\>\|t\|)の行を確認しよう。この行は、各係数の推定値に関する**p値**を示している。p値の詳細な説明は割愛するが、一般的にこの値が0.05を下回っていれば「統計的に有意である」と考えられている。

確認してみると、一番p値が大きい$polpc$において$3.12e-05 = 0.0000312$であるため、全ての推定結果が「統計的に有意である」と言える。

ただ、そんな計算せずともPr(\>\|t\|)の右側にある＊マークを見れば統計的な優位性が一目で分かる。Signif. codes: という行に＊の詳細が書かれており、＊＊＊で0.1%、＊＊で1%、＊で5%水準で統計的に有意であることを示している。


